<html>
<head>
  <title>Statistics - {{ form_title }} (ID: {{ form_id }})</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .btn, .btn-group .btn {
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .btn:hover, .btn:focus {
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 6px 18px rgba(118,75,162,0.12);
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.7s forwards;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: none;
      }
    }
    .toast {
      animation: slideInRight 0.5s;
    }
    @keyframes slideInRight {
      from { transform: translateX(100px); opacity: 0; }
      to   { transform: none; opacity: 1; }
    }
    .floating-shape {
      position: fixed;
      top: 10%;
      left: 80%;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, #764ba2 60%, #667eea 100%);
      border-radius: 50%;
      opacity: 0.15;
      animation: floatY 6s ease-in-out infinite alternate;
      z-index: 0;
    }
    @keyframes floatY {
      from { transform: translateY(0); }
      to   { transform: translateY(40px); }
    }
  </style>
</head>
<body>
  {{ navbar|safe }}
  <div class="container mt-5">
    <h1>Statistics for "{{ form_title }}" (ID: {{ form_id }})</h1>
    <div class="card mb-3">
      <div class="card-body">
        <h4>Submissions:</h4>
        <p>Total: <strong>{{ stats.total_submissions }}</strong></p>
        <h4>Fields:</h4>
        <p>Count: <strong>{{ stats.number_of_fields }}</strong></p>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-body">
        <h4>Responses Overview</h4>
        <canvas id="responsesChart" height="120"></canvas>
      </div>
    </div>

    <div class="d-flex gap-2">
      <a href="{{ url_for('delete_confirmation', form_id=form_id) }}"
         class="btn btn-danger">Delete Form</a>
      <a href="{{ url_for('allforms_view') }}"
         class="btn btn-secondary">Back to All Forms</a>
    </div>
    <a href="{{ url_for('export_csv', form_id=form_id) }}" class="btn btn-outline-success mb-3" title="Export as CSV">
      <i class="bi bi-file-earmark-spreadsheet"></i> download data
    </a>
  </div>
  <script>
document.addEventListener('DOMContentLoaded', function() {
  const chartData = {{ chart_data|safe }};
  const ctx = document.getElementById('responsesChart').getContext('2d');
  // Example: show the first field's stats
  const firstField = Object.keys(chartData)[0];
  if (firstField) {
    const data = chartData[firstField];
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(data),
        datasets: [{
          label: firstField + ' responses',
          data: Object.values(data),
          backgroundColor: '#764ba2'
        }]
      }
    });
  }
});
</script>
</body>
</html>
